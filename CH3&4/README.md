Lab 2.1: IDA 
=============================================

What you need:

*   A Windows machine, real or virtual, such as the Windows 2008 Server VM we've been using
*   The textbook: "Practical Malware Analysis"

Purpose
-------

You will practice using IDA Pro.

You should already have the lab files in your VM.

Downloading and Installing IDA Pro
----------------------------------

IDA is already installed in your VM, if not found:

In your Windows machine, open a Web browser and go to

[https://www.hex-rays.com/products/ida/support/download\_freeware.shtml](https://www.hex-rays.com/products/ida/support/download_freeware.shtml)

Download "**IDA Freeware**" and install it.

If that link is down, use this alternate download link:

Follow the Textbook
-------------------

Follow the instructions for **Lab 5-1** in the textbook, questions 1-8, to analyze Lab05-01.dll using only IDA Pro. There are more detailed solutions in the back of the book.

Opening Lab05-01.dll in IDA Pro
-------------------------------

- Launch IDA Pro. 

- Click **OK**. 

- Click **New**. 

- Click the "**PE Dynamic Library**" icon and click **OK**.

- Navigate to Lab05-01.dll and open it.

Q 1: Finding the Address of DLLMain
-----------------------------------

In IDA Pro, click **Windows**, "**Functions window**".

Click the "**Function name**" header to sort by name and scroll to the top.

Your image should show the location of DLLMain, as shown below:

![image](https://github.com/Cyber-Security-Club-HTU/CSC-Malware-Analysis/assets/75253629/a2d1ffeb-e95c-410d-a6a0-3e7158095331)

Press the **PrntScrn** key to capture an image of the whole desktop.

Open Paint and paste the image in with **Ctrl+V**.

Save this image with the filename "**Lab2.1 6a YOUR NAME**".

**YOU MUST SUBMIT WHOLE-DESKTOP IMAGES TO GET FULL CREDIT!**

Q 2: Find the import for gethostbyname
--------------------------------------

In IDA Pro, click **Windows**, **Imports**. Click the **Name** header to sort by name. Find "gethostbyname" -- note that capital letters and lowercase letters sort into separate groups.

Widen the **Address** column to make the entire address visible.

Your image should show the location of gethostbyname, as shown below:

![image](https://github.com/Cyber-Security-Club-HTU/CSC-Malware-Analysis/assets/75253629/fbcf2826-3992-4d08-af1e-d2b2eda91352)

Save a full-desktop image with the filename "**Lab2.1 6b YOUR NAME**".

Q 5: Count Local Variables for the Subroutine at 0x10001656
-----------------------------------------------------------

In IDA Pro, click **Windows**, "**IDA View-A**". Press the **SPACEBAR** to get to text view.

Press **g** to Go. Enter the address **0x10001656** and click **OK**.

Scroll up to show the comments IDA added to the start of the function, listing its local variables, as shown below:

![image](https://github.com/Cyber-Security-Club-HTU/CSC-Malware-Analysis/assets/75253629/543b5335-4984-46b3-91b8-114023b82b5c)

Save a full-desktop image with the filename "**Lab2.1 6c  YOUR NAME**".

Q 8: Finding the Purpose of the Code that References \\cmd.exe /c
-----------------------------------------------------------------

In IDA Pro, click **Windows**, **Strings**. Make the window larger. Sort by **String**. Find the String "**\\\\cmd.exe /c**" and double-click it. The function opens in text view, as shown below.

In the line containing "\\\\cmd.exe /c", double-click the address to the right of "XREF", as indicated by the red outline in the image below.

![image](https://github.com/Cyber-Security-Club-HTU/CSC-Malware-Analysis/assets/75253629/2fffed91-c744-46a8-8426-36a2effe601c)

Press the **SPACEBAR** to get to graph view, as shown below. "\\\\cmd.exe /c" is used in the little routine on the left.

![image](https://github.com/Cyber-Security-Club-HTU/CSC-Malware-Analysis/assets/75253629/cc1c1698-1c3a-4835-9c1a-3f48d274e80f)

Drag the graph view down to see the subroutines before it. About three boxes up you should find text beginning with "Hi, Master", as shown below.

![image](https://github.com/Cyber-Security-Club-HTU/CSC-Malware-Analysis/assets/75253629/d7d9602a-6cda-4446-8c3c-bfff2f992369)

Double-click **aHiMasterDDDD** to find the complete message. The purpose of the malware is clearly stated.

Your image should show what the code is doing, as shown below. The purpose is behind the red rectangle in the image below.

![image](https://github.com/Cyber-Security-Club-HTU/CSC-Malware-Analysis/assets/75253629/5874382f-e497-4d23-9d56-fd1a2bf7e252)

Save a full-desktop image with the filename "**Lab2.1 6d YOUR NAME**".

Turning in your Lab
-----------------------

Email the images showing to csc@htu.edu.jo with the subject line: **Lab2.1 YOUR NAME**
